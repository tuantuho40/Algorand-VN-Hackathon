from algosdk import account, mnemonic
from algosdk.v2client import algod
from algosdk.future import transaction

# Kết nối với mạng Algorand (sử dụng TestNet cho phát triển)
algod_address = "https://testnet-algorand.api.purestake.io/ps2"
algod_token = "YOUR_API_KEY"
headers = {
    "X-API-Key": algod_token,
}
algod_client = algod.AlgodClient(algod_token, algod_address, headers)

# Tạo hoặc nạp tài khoản
private_key, address = account.generate_account()
print(f"Account address: {address}")
print(f"Private key: {mnemonic.from_private_key(private_key)}")

# Đọc file TEAL
with open("approval.teal", "r") as f:
    approval_program = f.read()

with open("clear_state.teal", "r") as f:
    clear_state_program = f.read()

# Compile TEAL programs
approval_result = algod_client.compile(approval_program)
approval_binary = base64.b64decode(approval_result["result"])

clear_result = algod_client.compile(clear_state_program)
clear_binary = base64.b64decode(clear_result["result"])

# Tạo giao dịch triển khai ứng dụng
params = algod_client.suggested_params()
txn = transaction.ApplicationCreateTxn(
    sender=address,
    sp=params,
    on_complete=transaction.OnComplete.NoOpOC,
    approval_program=approval_binary,
    clear_program=clear_binary,
    global_schema=transaction.StateSchema(num_uints=3, num_byte_slices=1),
    local_schema=transaction.StateSchema(num_uints=3, num_byte_slices=0),
)

# Ký và gửi giao dịch
signed_txn = txn.sign(private_key)
tx_id = algod_client.send_transaction(signed_txn)
result = transaction.wait_for_confirmation(algod_client, tx_id, 4)
app_id = result["application-index"]
print(f"Application ID: {app_id}")
